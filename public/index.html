<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
</head>
<body>
        <div class="container-fluid">
                
                <div class="row">
                  <div class="col-sm-6" style="background-color:yellow;">
                      
                        <div class="checkbox" id="dragable">
                                <label><input type="checkbox" class=".dragable">Drag Me</label>
                         </div>
                              
                  </div>
                  <div class="col-sm-6">
                      <div class="sartable"  >
                        
                        <form id="saratable" style="background-color:pink">
                            <h2>Drop Here</h2>

                            <button  type="button" class="btn btn-primary" id="saveForm">Save</button>
                        </form>
                    </div>
                
                  </div>
                </div>
              </div>

    <!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
      
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body ">
                <input type="hidden" name="userid" id="userid">
                <div class="input-group">
              <lable>User</lable>
              <input type="text" id="user"  >
                
               
              <lable>width</lable>
              <input type="text" id="width">
            </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveModalId">Save</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
      
        </div>
      </div>
</body>
</html>
<script>
    $(document).ready(function(){
        i=1;

     $("#dragable").draggable({
         helper:'clone'
     })
     $("#saratable").droppable({
         accept : "#dragable",
       drop:function(event,ui){
           var element = '<div class="form-group droppable" id="drop'+i+'" ondblclick="myFunction(this.id)">  <label for="usr" id="user'+i+'">UserName</label>  <input type="text" class="form-control" id="input'+i+'" disabled="true"></div>'
         $("#saveForm").before(element)
         i++;
       }

     })
    
    })

    function myFunction(userId){
        $("#myModal").modal('show');
        $("#user").val('')
        $("#width").val('')
        $("#userid").val(userId);
        console.log(json_arry)
        if(json_arry.length!=0){
          for(let i=0;i<json_arry.length;i++){
            for(var keys in json_arry[i]){
            if(keys==userId){
              
              for (let j = 0; j < json_arry[i][keys].length; j++) {
                         
                           $.each(json_arry[j][keys], function (key, value) {
                            if(value["label"]!=undefined){
                              console.log(value)
                              $("#user").val(value["label"].label_name)
                            }   
                            if(value["input"]!=undefined){
                              console.log(value)
                              $("#width").val(value["input"].input_width)
                            }                   
                           });
                }
                
                             
            }
          }
          }
         
        }

     }

     $("#saveModalId").click(function(){
        var userId = $("#userid").val();
        $("#"+userId).find('label').text($("#user").val());
        $("#"+userId).find('input').width($("#width").val());
         $("#myModal").modal('hide'); 
     })

     var json_arry = [];
     
     $("#saveForm").click(function(){
         $(".droppable").each(function(){
            var json_obj = {};
             var parentId = this.id;
            var labelText = $("#"+parentId).find('label').text();
            var labelId = $("#"+parentId).find('label').attr('id');
            var inputWidth =parseInt($("#"+parentId).find('input').width());
            var inputId = $("#"+parentId).find('input').attr('id');
            json_obj[parentId] =  [{"label":{"label_id":labelId,"label_name":labelText}},{"input":{"input_id":inputId,"input_width":inputWidth}}];
            json_arry.push(json_obj)
         })
         console.log(json_arry)
         


            var data=json_arry;
            var html_up="";
            for (var i = 0; i < data.length; i++) {

                alert(JSON.stringify(data[i]));
                
                   $.each(data[i], function (key, value) {
                
                      // alert(key + "\t" + JSON.stringify(value));
                       //alert(data[i])
                       html_up += '<div class="form-group droppable" id="'+key+'" ondblclick="myFunction(this.id)">';
                       for (var i = 0; i < value.length; i++) {
                         //  alert(JSON.stringify(value[i]));
                         //alert(value[i])
                           $.each(value[i], function (key, value) {
                //alert(key + "\t" + JSON.stringify());
                               if(key =='label'){
                                  html_up += '<label for="usr" id="'+value.label_id+'">'+value.label_name+'</label>'
                
                }
                if(key =='input'){
                //alert(key + "\t" + JSON.stringify(value));
                //alert(value.width)
                  html_up +='<input type="text" class="form-control" id="'+value.input_id+'" disabled="true" style="width:'+value.input_width+'px"></div>';
                }
                
                           });
               
                
                
                
                }
                
                       //html += '<label id="lable1">username</label><input type="text" style="margin: 11px 0px;" id="text1"></div>';
                
                
                   });
                
                //
                //   html += '<div id="popup1" onclick="openModal(this.id)" class="data1"><label id="lable1">username</label><input type="text" style="margin: 11px 0px;" id="text1"></div>';
                
                }
        $("#saratable").empty();
         $("#saratable").append(html_up);
     })
</script>
     

